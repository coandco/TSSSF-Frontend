<!doctype html>
<html>
    <head>
        <title>TSSSFF Card Generator</title>
        <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
        <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
        <link href="cardStyling.css" rel="stylesheet">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <script>
            $(document).ready(function(){
                $("input[type=radio]").change(function(){
                    $("input[name="+$(this).attr("name")+"]").each(function(){
                        $(".card").removeClass($(this).attr("value"));
                    })
                    if ($(this).prop("checked")){
                        $(".card").addClass($(this).attr("value"));
                    }
                });

                $(window).resize(function(){
                    var hf = ($(window).height()-16)/1088,
                        wf = ($(window).width()-516)/788
                        f = Math.min(wf,hf);
                    
                    console.log(wf,hf);
                    if (wf < 0.3){
                        hf = ($(window).height()-216)/1088;
                        wf = ($(window).width()-16)/788;
                        f = Math.min(wf,hf);
                    }
                    $(".card").css("transform","scale("+f+")")
                    
                    $(".cardwrapper").width(788*f);
                    $(".cardwrapper").height(1088*f);
                });

                $(".card textarea").on("change keyup paste",function(){
                    var t = $(this),
                        o = $(".cardHelper ." + t.attr("class"));
                    o.text(t.val());
                    t.height(o.height());
                });

                $("#image").change(function(){
                    $(".card .image").css("background-image","url('"+$(this).val()+"')")
                })

                $("input, textarea").change(function(){
                    document.location.hash =
                        encodeURIComponent($(".card").attr("class").replace(/card ?/,""))+"/"+
                        encodeURIComponent($(".card .name").val())+"/"+
                        encodeURIComponent($(".card .attrs").val())+"/"+
                        encodeURIComponent($(".card .effect").val())+"/"+
                        encodeURIComponent($(".card .flavour").val())+"/"+
                        encodeURIComponent($("#image").val())
                })

                var inputValues = document.location.hash.substr("1").split("/");
                console.log(inputValues);

                if (inputValues.length == 6){
                    $.each(decodeURIComponent(inputValues[0]).split(" "),function(i,n){
                        $("input[value="+n+"]").prop("checked",true);
                    })
                    $(".card .name").val(decodeURIComponent(inputValues[1]))
                    $(".card .attrs").val(decodeURIComponent(inputValues[2]))
                    $(".card .effect").val(decodeURIComponent(inputValues[3]))
                    $(".card .flavour").val(decodeURIComponent(inputValues[4]))
                    $("#image").val(decodeURIComponent(inputValues[5]))

                    $("input[type=radio]:checked").change();
                    $("#image").change();
                }

                $(window).resize();
                $(".card textarea").change();
                

            });
        </script>

    </head>
    <body>
        
        <main class="clearAfter">
            <div class="cardwrapper">
                <div class="card pony maleFemale unicorn">
                    <input type="text" class="name" value="Glitter Shell"/>
                    <div class="image" style="
                        background-image: url('https://derpicdn.net/img/2013/9/30/438807/large.png');
                    "></div>
                    <div class="iconGender"></div>
                    <div class="iconRace"></div>
                    <div class="iconShip"></div>
                    <input type="text" class="attrs" value="BG Pony, Transgender, Snails"/>
                    <textarea class="effect">Different Socks (Special): This card counts as * for all goals and ; for all other card effects. Whilst gender swapped this card counts as * for both.</textarea>
                    <textarea class="flavour">I am different... It's like I'm wearing two different socks: one orange, one purple. My biggest secret is sometimes like to put a purple sock on over the orange. It's nice because I can smile at myself, but at the same time I know I'm just covering the orange one.
- Matching</textarea>
                </div>
            </div>
            <div class="cardHelper">
                <div class="effect"></div>
                <div class="flavour"></div>
            </div>
            <div class="controls">
                <header>
                    This tool is still in beta.</br>
                    Report all bugs to <a href="https://twitter.com/Ripp_">@Ripp_</a></br>
                    Feel free to check out the source on <a href="https://github.com/chao-master/TSSSFF-Generator">github</a>
                </header>
                <label><input type="radio" name="cardType" value="pony" checked="true"/>Pony</label>
                <label><input type="radio" name="cardType" value="ship"/>Ship</label>
                <br/>
                <label><input type="radio" name="gender" value="female"/>Female</label>
                <label><input type="radio" name="gender" value="male"/>Male</label>
                <label><input type="radio" name="gender" value="maleFemale" checked="true"/>Male &amp; Female</label>
                <br/>
                <label><input type="radio" name="race" value="unicorn" checked="true"/>Unicorn</label>
                <label><input type="radio" name="race" value="pegasus"/>Pegasus</label>
                <label><input type="radio" name="race" value="earthPony"/>Earth Pony</label>
                <label><input type="radio" name="race" value="alicorn"/>Alicorn</label>
                <br/>
                <label>Image (URL): <input type="text" id="image" value="https://derpicdn.net/img/2013/9/30/438807/large.png"/></label>
            </div>
        </main>
        <footer>
        </footer>
    </body>
</html>
